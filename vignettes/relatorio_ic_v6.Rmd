---
output:
   html_notebook:
     toc: yes
   pdf_document:
     toc: yes
   word_document:
     toc: yes
   html_document:
     df_print: paged
     toc: yes
---

```{r, message=FALSE, echo=FALSE, eval=FALSE}
# Para linkar partes de um texto no rmarkdown, use isso:
## [Descrition] (#id_name)
## <a id = "id_name"> </a>

# Para justificar partes de um texto no rmarkdown, use isso:
## <p style='text-align: justify;'>
## </p>
```


```{r, message=FALSE, echo=FALSE}
# Limpando a área de trabalho
rm(list = ls())

# Tempo Universal Coordenado
Sys.setenv(TZ = "UTC")

# Pacotes
packs <- c("dplyr", "rio", "ggplot2", "kableExtra", "knitr", "lubridate", "magrittr", "openair", "padr", "scales","stringr", "tidyverse") # "plyr"

easypackages::libraries(packs)
rm(packs)

# EMAs Selecionadas
emas_sel <-
  rio::import('../../jbc-ic/data_saves/summary_80.rds') %>%
  #readRDS('/home/jonas/Documents/GITHUB/jbc-ic/data_saves/summary_80.rds') %>%
  dplyr::select(site, state, name, start, period, lat, lon, alt) %>%
  arrange(start, site)

# Scripts
source('../R/grama_psph.R')
source('../R/create.R')
source('../../jbc-ic/R/utils.R')

# Suspect by
directory <- "/home/jonas/Documents/GITHUB/jbc-ic/output/"

```

# <font size="4"> __IDENTIFICAÇÃO__

<font size="3">
__Título do plano de trabalho:__
Controle de qualidade dos dados da temperatura do ar, para as estações meteorológicas automáticas do INMET na região sul do Brasil

__Nome do bolsista:__
Jonas Barboza Corrêa

__Nome do orientador:__
Jônatan Dupont Tatsch

__Local de execução:__
Laboratório de Hidrometeorologia (LHMet - UFSM)

# <font size="4"> __1. INTRODUÇÃO__

<font size="3">
<p style='text-align: justify;'>
As observações meteorológicas (e relacionadas ambientais e geofísicas) são feitas por uma variedade de razões. Eles são usados para a preparação em tempo real de análises meteorológicas, previsões e advertências meteorológicas severas, para o estudo do clima, para operações locais dependentes do clima (por exemplo, operações locais de vôo de aeródromo, trabalhos de construção em terra e no mar), para hidrologia e meteorologia agrícola, e para pesquisa em meteorologia e climatologia ([WMO, 2012](#WMO, 2012)).
</p>

<p style='text-align: justify;'>
Nos últimos anos, a automação da estação e o aumento das velocidades de transmissão de dados estão em progresso constante. É necessário um controle de qualidade rápido e efetivo para identificação e sinalização de erros ou observações suspeitas para proporcionar acesso rápido à informação e disseminação de observações confiáveis quanto possível aos usuários. Geralmente, os objetivos para o desenvolvimento de sistemas de controle de qualidade são os seguintes: tornar o controle de qualidade mais eficaz e mais próximo do tempo real;  identificar erros de calibração, medição e comunicação tão próximos da fonte de observação quanto possível; focar no desenvolvimento automático de algoritmos de controle de qualidade; desenvolver um sistema abrangente de sinalização para indicar o nível de qualidade dos dados; para facilitar aos usuários de dados identificar dados suspeitos e errados e destacar os valores corrigidos ([VEJEN et al., 2002](#VEJEN et al., 2002)). Entre os principais tipos de erros, encontram-se os erros aleatórios, os erros sistemáticos, erros grandes e os  erros micrometeorológicos.
</p>

<p style='text-align: justify;'>
Os erros aleatórios são distribuídos de forma mais ou menos simétrica em torno de zero e não dependem do valor medido. Erros aleatórios, por vezes, resultam em superestimação e às vezes em subestimação do valor real. Em média, os erros se cancelam mutuamente. Os erros sistemáticos, por outro lado, são distribuídos de forma assimétrica em torno de zero. Em média, esses erros tendem a polarizar o valor medido acima ou abaixo do valor real. Uma razão de erros aleatórios é uma deriva a longo prazo de sensores. Erros grandes (ásperos) são causados por mau funcionamento de dispositivos de medição ou por erros cometidos durante o processamento de dados; Os erros são facilmente detectados por cheques. Os erros micrometeorológicos (representatividade) são o resultado de perturbações em pequena escala ou sistemas meteorológicos que afetam a observação do tempo. Estes sistemas não são completamente observáveis pelo sistema de observação devido à resolução temporal ou espacial do sistema de observação. No entanto, quando tal fenômeno ocorre durante uma observação de rotina, os resultados podem parecer estranhos em comparação com as observações circundantes que ocorrem ao mesmo tempo ([ZAHUMENSKÝ, 2004](#ZAHUMENSKÝ, 2004)).
</p>

<p style='text-align: justify;'>
No Brasil, os dados fornecidos, em sua maioria, encontram-se em sua forma bruta, sem que a qualidade dos mesmos seja verificada. Este trabalho consiste em, através da aplicação de certos métodos de controle de qualidade (QC), verificar e rotular tais dados como suspeitos ou não, para que futuramente possam serem melhores aproveitados em seu uso, com um maior grau de confiabilidade.
</p>

# <font size="4"> __2. METODOLOGIA__

<font size="3">
<p style='text-align: justify;'>
A metodologia adotada consiste em duas partes, inicialmente os dados brutos passarão por uma seleção inicial baseada em certos fatores, em seguida, eles serão submetidos à uma série de testes de controle de qualidade, que os qualificarão como suspeitos ou não, além, de obter-se certas informações relevantes a respeito deles.
</p>

## <font size="3.5"> __2.1 SELEÇÃO DO PERÍODO DE DADOS__

<font size="3">
<p style='text-align: justify;'>
Neste trabalho, serão usados dados horários da Temperatura do Ar (Tar) de 91 Estações Meteorológicas Automáticas (EMAs) do [Instituto Nacional de Meteorologia (INMET)](http://www.inmet.gov.br/portal/), localizadas na região sul do Brasil ([Figura 01a](#Figura 01)). Ao todo, os estados do Paraná (PR), Rio Grande do Sul (RS) e Santa Catarina (SC), possuem, respectivamente,  27, 42 e 22 EMAs em funcionamento, tendo períodos de funcionamento que variam de pouco mais de um mês (A897 - Cambará do Sul), até mais de 16 anos (A801 - Porto Alegre) ([Figura 01b](#Figura 01)). Os dados horários de Tar utilizados estão no padrão do [Tempo Universal Coordenado (UTC)](https://pt.wikipedia.org/wiki/Tempo_Universal_Coordenado).
</p>

<p style='text-align: justify;'>
O modelo dos sensores de temperatura usado é o QMH102 da fabricante Vaisala, estes possuem acurácia de ±0,2°C, e são instalados a uma altura de 2 metros acima do solo ([VAISALA, 2002](#VAISALA, 2002)). Uma estação meteorológica automática (EMA) deve ser instalada  em  uma  área gramada fechada com um cercado de tela metálica de 14m x 18m e um mínimo de $50m^2$ livre de efeitos de construções ao seu redor e protegida contra roubo e vandalismos ([INMET, 2011](#INMET, 2011)).
</p>

<font size="2">
<a id = "Figura 01"> </a>
__Figura 01__ – (a) Localização das 91 EMAs do INMET no sul do Brasil, (b) Período de dados das 91 EMAs em anos.
![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_2maps_01.png)

<font size="3">
<p style='text-align: justify;'>
Dois critérios serão usados para a seleção dos dados que serão utilizados, (i) as estações meteorológicas automáticas devem terem no mínimo quatro anos de dados (podendo serem descontínuos), para haver um tempo mínimo para análise ser consistente, e (ii) o período de análise terá início em 01/01/2008, tendo como data final 31/12/2016. Este ano inicial foi escolhido, pois a partir dele notou-se um bom acrescimo na quantidade de EMAs existente ([Figura 02](#Figura 02)), além de que, a distribuição espacial delas tornou-se mais homogênea ([Figura 03](#Figura 03) e [Figura 04](#Figura 04)).
</p>

<font size="2">
<a id = "Figura 02"> </a>
__Figura 02__ – EMAs com início de funcionamento pré-pós 2008
![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_prepos2008.png)

<font size="2">
<a id = "Figura 03"> </a>
__Figura 03__ – Disponibilidade mensal para cada uma das 91 EMA da região sul do Brasil.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_dispomen.png)

<font size="2">
<a id = "Figura 04"> </a>
__Figura 04__ – Evolução temporal mensal do número de EMAs.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_evomen.png)

<font size="3">
<p style='text-align: justify;'>
Para que a seleção fosse feita, antes, foi necessário uma regularização das séries temporais de cada EMA, para assim garantir que todas tenham 24 horas em cada dia, e 365 (ou 366 dias, se ano bissexto) em cada ano.
</p>

<p style='text-align: justify;'>
Após a seleção, restaram ao todo 80 EMAs para análise, estando 24 localizadas no estado do Paraná (PR), 36 no estado do Rio Grande do Sul (RS) e 20 no estado de Santa Catarina (SC), com disponibilidade de dados variando de 41,5% (A883 - Ibirubá) até 99,4 (A803 - Porto Alegre) ([Figura 05](#Figura 05)). Na [Tabela 01](#Tabela 01) é mostrado as EMAs selecionadas que apresentaram o maior período de dados.
</p>

<font size="2">
<a id = "Figura 05"> </a>
__Figura 05__ – Disponibilidade das 80 EMAs selecionadas do período de 2008 até 2016

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_disponibilidade.png)

<font size="2">
<a id = "Tabela 01"> </a>
__Tabela 01__ – Informações sobre as EMAs: Início de Funcionamento, Período, Latitude, Longitude, Altitude.

```{r, echo=FALSE}
t01 <- emas_sel

names(t01)[1] <- "Código"
names(t01)[2] <- "Estado"
names(t01)[3] <- "Nome"
names(t01)[4] <- "Início de Funcionamento" 
names(t01)[5] <- "Período (em anos)"
names(t01)[6] <- "Latitude (em °)"
names(t01)[7] <- "Longitude (em °)"
names(t01)[8] <- "Altitude (em m)"
#knitr::kable(t01)
DT::datatable(t01)

```

### <font size="3"> __2.1.1 Informações Técnicas__

<font size="3">
<p style='text-align: justify;'>
Para a realização deste trabalho, foi utilizado a linguagem de programação [R](#R) (R Core Team, 2017), com o software livre com ambiente de desenvolvimento integrado [Rstudio](#RStudio) (RStudio Team, 2016), e os seguintes pacotes foram utilizados:
</p>

<p style='text-align: justify;'>
[dplyr](#dplyr) (WICKHAM, 2017), [DT](#DT) (XIE, 2016), [ggplot2](#ggplot2) (WICKHAM, 2016), [kableExtra](#kableExtra) (ZHU, 2017), [knitr](#knitr) (XIE, 2017), [lubridate](#lubridate) (GROLEMUND, 2016), [magrittr](#magrittr) (BACHE; WICKHAM, 2014), [openair](#openair) (CARSLAW; ROPKINS, 2017), [padr](#padr) (THOEN, 2017), [plyr](#plyr) (WICKHAM, 2016), [raster](#raster) (HIJMANS, 2016), [scales](#scales) (WICKHAM, 2017), [stringr](#stringr) (WICKHAM, 2017), [tidyverse](#tidyverse) (WICKHAM, 2017).
</p>

## <font size="3.5"> __2.2 TESTES DE CONTROLE DE QUALIDADE__

<font size="3">
<p style='text-align: justify;'>
Os testes aplicados aos dados da temperatura do ar serão dividos em  categorias, sendo elas: Limites do Intervalo de Variação, Persistência Temporal, Consistência Interna, Consistência Temporal, Consistência Espacial e Homogeneidade Temporal. Eles são mostrados na [Tabela 02](#Tabela 02), e os dados foram considerados suspeitos quando os testes são válidos.
</p>

<font size="2">
<a id = "Tabela 02"> </a>
__Tabela 02__ – Controles de qualidade (QCs) aplicados aos dados da temperatura do ar das EMAs do INMET

```{r, message=FALSE, echo=FALSE}

# Lista com os tipos de controles de qualidades
qc_list <- c(
  "_(QC1) Teste do Intervalo de Variação_",
  "_(QC2) Teste de Persistência Temporal_",
  "_(QC3) Teste de Consistência Interna_",
  "_(QC4) Teste de Consistência Temporal_")

# Lista com as equações dos controles de qualidades
eq_list <- c(
  "$T_{avg}$ < $-50°C$ ou $T_{avg}$ > $60°C$",
  "$T_{avg}$ < $T_{low}$ ou $T_{avg}$ > $T_{high}$",
  "$T_{avg} (h)$ = $T_{avg} (h-1)$ = $T_{avg} (h-2)$ = ... = $T_{avg} (h-n)$" ,
  "$T_{min}(h)$ ≥ $T_{max}(h)$",
  "$T_{inst}(h)$ < $T_{min}(h)$ ou $T_{inst}(h)$ > $T_{max}(h)$",
  "$T_{avg}(h)$ < $T_{davg,f}(h)$",
  "$T_{avg}(d)$ < $T_{min}(d)$ ou $T_{avg}(d)$ > $T_{max}(d)$",
  "$T_{max}(d)$ < $T_{min}(d-1)$",
  "$T_{min}(d)$ ≥ $T_{max}(d-1)$",
  "$|T_{avg}(h)$ - $T_{avg}(h-dt)|$ > $T_{tol} (dt)$")

# Lista com as referências dos controles de qualidades
refer_list <- c(
  "[_(ESTÉVEZ el al., 2011)_](#ESTÉVEZ el al., 2011)",
  "[_(ESTÉVEZ el al., 2011)_](#ESTÉVEZ el al., 2011)",
  "[_(MEEK; HATFIELD, 1994)_](#MEEK; HATFIELD, 1994)",
  "[_(ESTÉVEZ el al., 2011)_](#ESTÉVEZ el al., 2011)",
  "",
  "",
  "[_(MEEK; HATFIELD, 1994)_](#MEEK; HATFIELD, 1994)",
  "[_(ESTÉVEZ el al., 2011)_](#ESTÉVEZ el al., 2011)",
  "[_(ESTÉVEZ el al., 2011)_](#ESTÉVEZ el al., 2011)",
  "[_(WMO, 1993)_](#WMO, 1993)")

# Número de sub-items de cada tipo de controle de qualidade (correspondente à QC_LIST)
qc_groups <- c(2, 1, 6, 1) 

# Nome das colunas em ordem
col_names <- c("Processo de Validação", "Temperatura do Ar (em °C)", "Referências")

# Gerando tabela com os qcs
qc.table(
  QC_LIST = qc_list,
  EQUATIONS_LIST = eq_list,
  REFERENCES_LIST = refer_list,
  QC_GROUPS = qc_groups,
  COLUMNS_NAMES = col_names)
```

<font size="2">
<p style='text-align: justify;'>
_Nota:_
$T_{avg}(h)$ é a média aritmética simples de $T_{min}(h)$ (temperatura mínima do ar) e $T_{max}(h)$ (temperatura máxima do ar);
$-50°C$ e $60°C$ são, respectivamente, os limites mínimo e máximo instrumental;
$T_{low}$ e $T_{high}$ são, respectivamente, os valores mínimo e máximo já registrados pela estação climatológica mais próxima de cada EMA;
$n$ é um número natural, correspondente à(s) hora(s) anteriores à $T_{avg} (h)$;
$T_{min}(h)$ e $T_{max}(h)$ são, respectivamente, os valores mínimo e máximo horário de temperatura;
$T_{inst}(h)$ é a temperatura instantânea do ar, que corresponde à média de um minuto de 12 valores de amostragens medidos a cada cinco segundos;
$T_{davg,f}(h)$ é a temperatura média do ponto de orvalho, filtrada apenas com dados que passaram nos testes 'a' e 'b' do QC3, aplicados para a variável $T_{davg}(h)$ (temperatura média do ponto de orvalho horária);
$T_{avg}(d)$ é média aritmética simples das $T_{avg}(h)$;
$T_{min}(d)$ é o menor valor de temperatura registrada no dia das $T_{min}(h)$;
$T_{max}(d)$ é o maior valor de temperatura registrada no dia das $T_{max}(h)$;
$T_{min}(d-1)$ é a temperatura mínima do dia anterior;
$T_{max}(d-1)$ é a temperatura máxima do dia anterior;
$dt$ são valores correspondentes a uma determinada hora, sendo eles: 1h, 2h, 3h, 6h e 12h;
$T_{tol} (dt)$ é um valor tolerável de temperatura, que varia com $dt$, recebendo os seguintes valores respectivos: 4°C (1h), 7°C (2h), 9°C (3h), 15°C (6h) e 25°C (12h).
</p>

# <font size="4"> __3. RESULTADOS__

## <font size="3.5"> __3.1 Limites do Intervalo de Variação (QC1)__

<font size="3">
<p style='text-align: justify;'>
__(a)__ A aplicação do teste de Limites do Intervalo de Variação 'a' nas 80 EMAs selecionadas, não gerou nenhuma EMA que apresentou dados considerados suspeitos.
</p>

<font size="3">
<p style='text-align: justify;'>
__(b)__ A aplicação do teste de Limites do Intervalo de Variação 'b' nas 80 EMAs selecionadas, gerou 66 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.1006% (79 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A845 – Morro Da Igreja/Bom Jardim Da Serra (SC), com 2.1872% (1726 horas) ([Tabela 03](#Tabela 03)).
</p>

<font size="2">
<a id = "Tabela 03"> </a>
__Tabela 03__ – EMAs com maior número de dados considerados suspeitos no teste QC1b em ordem decrescente.

```{r, echo=FALSE}
t02 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc1b-summary-tavg-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t02

# (100/78912) * (mean((readRDS("/home/jonas/Documents/GITHUB/jbc-ic/output/qc1b-summary-tavg-data-inmet-2008-2016-4yrs-south.rds") %>% arrange(desc(perc)))[[4]], na.rm = TRUE))

#result.text(QRT_DF = t02, TYPE = "hour", TESTE = "Limites do Intervalo de Variação", LETRA = "b", NUMERO_TABELA = "03")
```

__Figura 06__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC1b.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc1b.png)

## <font size="3.5"> __3.2 Persistência Temporal (QC2)__

<font size="3">

<p style='text-align: justify;'>
__(a)__ A aplicação do teste de Persistência Temporal 'a' nas 80 EMAs selecionadas, gerou 80 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 4.6418% (3663 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A834 – Tramandaí (RS), com 9.446% (7454 horas) ([Tabela 04](#Tabela 04)).
</p>

<font size="2">
<a id = "Tabela 04"> </a>
__Tabela 04__ – EMAs com maior número de dados considerados suspeitos no teste QC2a em ordem decrescente.

```{r, echo=FALSE}
t03 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc2a-summary-tavg-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t03

#result.text(QRT_DF = t03, TYPE = "hour", TESTE = "Persistência Temporal", LETRA = "a", NUMERO_TABELA = "04")
```

__Figura 07__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC2a.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc2a.png)

## <font size="3.5"> __3.3 Consistência Interna (QC3)__

<font size="3">
<p style='text-align: justify;'>
__(a)__ A aplicação do teste de Consistência Interna 'a' nas 80 EMAs selecionadas, gerou 80 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.1511% (119 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A851 – Itapoá (SC), com 0.6818% (538 horas) ([Tabela 05](#Tabela 05)).
</p>

<font size="2">
<a id = "Tabela 05"> </a>
__Tabela 05__ – EMAs com maior número de dados considerados suspeitos no teste QC3a em ordem decrescente.

```{r, echo=FALSE}
t04 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc3a-summary-tmin-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t04

#result.text(QRT_DF = t04, TYPE = "hour", TESTE = "Consistência Interna", LETRA = "a", NUMERO_TABELA = "05")
```

__Figura 08__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC3a.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc3a.png)

<font size="3">
<p style='text-align: justify;'>
__(b)__ A aplicação do teste de Consistência Interna 'b' nas 80 EMAs selecionadas, gerou 12 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.0062% (5 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A880 – Vacaria (RS), com 0.0558% (44 horas) ([Tabela 06](#Tabela 06)).
</p>

<font size="2">
<a id = "Tabela 06"> </a>
__Tabela 06__ – EMAs com maior número de dados considerados suspeitos no teste QC3b em ordem decrescente.

```{r, echo=FALSE}
t05 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc3b-summary-tinst-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t05

#result.text(QRT_DF = t05, TYPE = "hour", TESTE = "Consistência Interna", LETRA = "b", NUMERO_TABELA = "06")
```

__Figura 09__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC3b.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc3b.png)

<font size="3">
<p style='text-align: justify;'>
__(c)__ A aplicação do teste de Consistência Interna 'c' nas 80 EMAs selecionadas, gerou 45 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.0769% (61 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A845 – Morro Da Igreja (Bom Jardim Da Serra) (SC), com 1.0657% (841 horas) ([Tabela 07](#Tabela 07)).
</p>

<font size="2">
<a id = "Tabela 07"> </a>
__Tabela 07__ – EMAs com maior número de dados considerados suspeitos no teste QC3c em ordem decrescente.

```{r, echo=FALSE}
t06 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc3c-summary-tavg-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t06

#result.text(QRT_DF = t06, TYPE = "hour", TESTE = "Consistência Interna", LETRA = "c", NUMERO_TABELA = "07")
```

__Figura 10__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC3c.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc3c.png)

<font size="3">
<p style='text-align: justify;'>
__(d)__ A aplicação do teste de Consistência Interna "d" nas 80 EMAs selecionadas, não gerou nenhuma EMA que apresentou dados considerados suspeitos.
</p>

<font size="3">
<p style='text-align: justify;'>
__(e)__ A aplicação do teste de Consistência Interna 'e' nas 80 EMAs selecionadas, gerou 57 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.135% (4 dias), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A807 – Curitiba (PR), com 0.6083% (20 dias) ([Tabela 08](#Tabela 08)).
</p>

<font size="2">
<a id = "Tabela 08"> </a>
__Tabela 08__ – EMAs com maior número de dados considerados suspeitos no teste QC3e em ordem decrescente.

```{r, echo=FALSE}
t07 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc3e-summary-tmax-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "days",
#  RETURN = "table")
  RETURN = "dt")

t07

#result.text(QRT_DF = t07, TYPE = "day", TESTE = "Consistência Interna", LETRA = "e", NUMERO_TABELA = "08")
```

__Figura 11__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC3e.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc3e.png)

<font size="3">
<p style='text-align: justify;'>
__(f)__ A aplicação do teste de Consistência Interna 'f' nas 80 EMAs selecionadas, gerou 69 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.0908% (3 dias), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A851 – Itapoá (SC), com 0.3954% (13 dias) ([Tabela 09](#Tabela 09)).
</p>

<font size="2">
<a id = "Tabela 09"> </a>
__Tabela 09__ – EMAs com maior número de dados considerados suspeitos no teste QC3f em ordem decrescente.

```{r, echo=FALSE}
t08 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc3f-summary-tmin-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "days",
#  RETURN = "table")
  RETURN = "dt")

t08

#result.text(QRT_DF = t08, TYPE = "day", TESTE = "Consistência Interna", LETRA = "f", NUMERO_TABELA = "09")
```

__Figura 12__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC3f.

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc3f.png)


## <font size="3.5"> __3.4 Consistência Temporal (QC4)__

<font size="3">
<p style='text-align: justify;'>
__(a)__ Este controle de qualidade é divido em partes, de acordo com a variação horária da temperatura.
</p>

<p style='text-align: justify;'>
+ Para 1 hora: A aplicação do teste de Consistência Temporal 'a' nas 80 EMAs selecionadas, gerou 80 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.2705% (213 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A875 – General Carneiro (PR), com 2.0276% (1600 horas) ([Tabela 10](#Tabela 10)).
</p>

<font size="2">
<a id = "Tabela 10"> </a>
__Tabela 10__ – EMAs com maior número de dados considerados suspeitos no teste QC4a (1h) em ordem decrescente.

```{r, echo=FALSE}
t09 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc4a-summary-tavg-01h-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t09

#result.text(QRT_DF = t09, TYPE = "hour", TESTE = "Consistência Temporal", LETRA = "a", NUMERO_TABELA = "10")
```

__Figura 13__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC4a (1h).

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc4a_01h.png)

<font size="3">

<p style='text-align: justify;'>
+ Para 2 hora: A aplicação do teste de Consistência Temporal 'a' nas 80 EMAs selecionadas, gerou 80 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.3029% (239 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A875 – General Carneiro (PR), com 2.4838% (1960 horas) ([Tabela 11](#Tabela 11)).
</p>

<font size="2">
<a id = "Tabela 11"> </a>
__Tabela 11__ – EMAs com maior número de dados considerados suspeitos no teste QC4a (2h) em ordem decrescente.

```{r, echo=FALSE}
t10 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc4a-summary-tavg-02h-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t10

#result.text(QRT_DF = t10, TYPE = "hour", TESTE = "Consistência Temporal", LETRA = "a", NUMERO_TABELA = "11")
```

__Figura 14__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC4a (2h).

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc4a_02h.png)

<font size="3">

<p style='text-align: justify;'>
+ Para 3 hora: A aplicação do teste de Consistência Temporal 'a' nas 80 EMAs selecionadas, gerou 80 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.3767% (297 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A875 – General Carneiro (PR), com 3.1288% (2469 horas) ([Tabela 12](#Tabela 12)).
</p>

<font size="2">
<a id = "Tabela 12"> </a>
__Tabela 12__ – EMAs com maior número de dados considerados suspeitos no teste QC4a (3h) em ordem decrescente.

```{r, echo=FALSE}
t11 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc4a-summary-tavg-03h-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t11

#result.text(QRT_DF = t11, TYPE = "hour", TESTE = "Consistência Temporal", LETRA = "a", NUMERO_TABELA = "12")
```

__Figura 15__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC4a (3h).

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc4a_03h.png)

<font size="3">

<p style='text-align: justify;'>
+ Para 6 hora: A aplicação do teste de Consistência Temporal 'a' nas 80 EMAs selecionadas, gerou 72 EMAs que apresentaram dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.1538% (121 horas), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A875 – General Carneiro (PR), com 1.6778% (1324 horas) ([Tabela 13](#Tabela 13)).
</p>

<font size="2">
<a id = "Tabela 13"> </a>
__Tabela 13__ – EMAs com maior número de dados considerados suspeitos no teste QC4a (6h) em ordem decrescente.

```{r, echo=FALSE}
t12 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc4a-summary-tavg-06h-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t12

#result.text(QRT_DF = t12, TYPE = "hour", TESTE = "Consistência Temporal", LETRA = "a", NUMERO_TABELA = "13")
```

__Figura 16__ – Distribuição espacial das EMAs com dados considerados suspeitos no teste QC4a (12h).

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_qc4a_06h.png)

<font size="3">

<p style='text-align: justify;'>
+ Para 12 hora: A aplicação do teste de Consistência Temporal 'a' nas 80 EMAs selecionadas, gerou 1 EMA que apresentou dados considerados suspeitos. A média da porcentagem de dados considerados suspeitos nesse teste foi 0.0013% (1 hora), e a EMA que apresentou maior porcentagem de dados considerados suspeitos foi a A875 – General Carneiro (PR), com 0.0013% (1 hora) ([Tabela 14](#Tabela 14)).
</p>

<font size="2">
<a id = "Tabela 14"> </a>
__Tabela 14__ – EMAs com maior número de dados considerados suspeitos no teste QC4a (3h) em ordem decrescente.

```{r, echo=FALSE}
t13 <- qc.results.table(
  DIRECTORY = '/home/jonas/Documents/GITHUB/jbc-ic/output/qc4a-summary-tavg-12h-data-inmet-2008-2016-4yrs-south.rds',
  EMAS = emas_sel,
  TIME = "hours",
#  RETURN = "table")
  RETURN = "dt")

t13

#result.text(QRT_DF = t13, TYPE = "hour", TESTE = "Consistência Temporal", LETRA = "a", NUMERO_TABELA = "14")
```

<font size="3">
__(b)__ Valente & Tatsch

## <font size="3.5"> __3.5 Consistência Espacial (QC5)__


## <font size="3.5"> __3.6 Homogeneidade Temporal (QC6)__


## <font size="3.5"> __3.7 Resumo dos Resultados__

### <font size="3"> __3.7.1 Dados considerados suspeitos por EMA__

<font size="2">
__Tabela 15__ – Total absoluto de dados considerados suspeitos em cada EMA.

```{r, echo=FALSE}
suspect.by.site(DIRECTORY = directory, SUMMARY = emas_sel, TABLE = TRUE)
```

<font size="2">
<p style='text-align: justify;'>
_Nota:_
* total de dados horários suspeitos detectados nos testes qc1a, qc1b, qc2a, qc3a, qc3b, qc3c e qc4a (1h, 2h, 3h, 6h e 12h);
** total de dados diários suspeitos detectados nos testes qc3d, qc3e e qc3f.
<p style='text-align: justify;'>

__Figura 17__ – Distribuição espacial das EMAs com maior quantidade absoluta de dados (a) horários e (b) diários considerados suspeitos

![](/home/jonas/Documents/GITHUB/relatorio-ic/images/img_totEMA.png)

### <font size="3"> __3.7.2 Dados considerados suspeitos por QC__

<font size="2">
__Tabela 16__ – Total absoluto de dados considerados suspeitos em cada teste.

```{r, echo=FALSE}
sbqc <- suspect.by.qc(DIRECTORY = directory, TABLE = TRUE)

df <- ((sbqc$x$data)[-1])
names(df)[2] <- 'tipo'
df[2] <- substr(df$tipo, 1,1)
df[4] <- as.numeric(df[[4]])

df %>% filter(tipo == 'h') %>% arrange(desc(Suspeitos))
df %>% filter(tipo == 'd') %>% arrange(desc(Suspeitos))


```

### <font size="3"> __3.7.3 Dados considerados suspeitos por estado__

<font size="2">
__Tabela 17__ – Total absoluto de dados horários e diários considerados suspeitos por estado

```{r, echo=FALSE}

sbs <- suspect.by.site(DIRECTORY = directory, SUMMARY = emas_sel)

sustate <-
  sbs %>% 
  dplyr::arrange(desc(suspect_hour)) %>% 
  dplyr::arrange(state, site) %>% 
  dplyr::group_by(state) %>%
  dplyr::summarise(
    suspect_h = sum(suspect_hour, na.rm = TRUE),
    suspect_d = sum(suspect_day, na.rm = TRUE)) %>% 
  dplyr::ungroup() %>% 
  dplyr::arrange(state)
names(sustate)[1] <- "Estado"
names(sustate)[2] <- "Suspeitos* (em horas)"
names(sustate)[3] <- "Suspeitos** (em dias)"
DT::datatable(sustate)
```

<font size="2">
<p style='text-align: justify;'>
_Nota:_
* total de dados horários suspeitos detectados nos testes qc1a, qc1b, qc2a, qc3a, qc3b, qc3c e qc4a (1h, 2h, 3h, 6h e 12h);
** total de dados diários suspeitos detectados nos testes qc3d, qc3e e qc3f.
</p>

# <font size="4"> __4. CONCLUSÃO__

<font size="3">
<p style='text-align: justify;'>
Somando os resultados dos testes, as estações que apresentaram o maior número de dados suspeitos nos testes horários foram: A875 – General Carneiro (PR) com 10895 horas, A845 – Morro Da Igreja/Bom Jardim da Serra (SC) com 8461 horas e A834 – Tramandaí (RS) com 7820 horas; nos testes diários foram: A807 – Curitiba (PR) com 27 dias, A851 – Italpóa (SC) com 22 dias e A824 – Icaraíma (PR) com 19 dias. 
</p>

<p style='text-align: justify;'>
No geral, embora a maioria da estações meteorológicas automáticas tenham apresentado ao mínimo um teste onde foram detectados dados suspeitos, a porcentagem de dados suspeitos detectada em cada estação, em relação ao número total de horas de dados na mesma, é suficientemente pequeno.
</p>

# <font size="4"> __5. REFERÊNCIAS BIBLIOGRÁFICAS__

<font size="3">

<a id = "openair"> </a>
Carslaw, D. C. and K. Ropkins, __(2012) openair --- an R package for air quality data analysis.__ Environmental Modelling & Software. Volume 27-28, 52-61. <https://cran.r-project.org/web/packages/openair/index.html>

<a id = "padr"> </a>
Edwin Thoen (2017). __padr: Quickly Get Datetime Data Ready for Analysis.__ R package version 0.3.0. <https://CRAN.R-project.org/package=padr>

<a id = "ESTÉVEZ el al., 2011"> </a>
ESTÉVEZ, J. et al. __Guidelines on validation procedures for meteorological data from automatic weather stations.__ Journal of Hydrology, p. 147, 2011. <https://www.sciencedirect.com/science/article/pii/S0022169411001594>

<a id = "lubridate"> </a>
Garrett Grolemund, Hadley Wickham (2011). __Dates and Times Made Easy with lubridate.__ Journal of Statistical Software, 40(3), 1-25. URL <http://www.jstatsoft.org/v40/i03/>.

<a id = "dplyr"> </a>
Hadley Wickham, Romain Francois, Lionel Henry and Kirill Müller (2017). __dplyr: A Grammar of Data Manipulation.__ R package version 0.7.4. <https://CRAN.R-project.org/package=dplyr>

<a id = "ggplot2"> </a>
H. Wickham. __ggplot2: Elegant Graphics for Data Analysis.__ Springer-Verlag New York, 2009 <https://cran.r-project.org/web/packages/ggplot2/index.html>

<a id = "scales"> </a>
Hadley Wickham (2017). __scales: Scale Functions for Visualization.__ R package version 0.5.0. <https://CRAN.R-project.org/package=scales>

<a id = "stringr"> </a>
Hadley Wickham (2017). __stringr: Simple, Consistent Wrappers for Common String Operations.__ R package version 1.2.0. <https://CRAN.R-project.org/package=stringr>

<a id = "tidyverse"> </a>
Hadley Wickham (2017). __tidyverse: Easily Install and Load 'Tidyverse' Packages.__ R package version 1.1.1. <https://CRAN.R-project.org/package=tidyverse>

<a id = "plyr"> </a>
Hadley Wickham (2011). __The Split-Apply-Combine Strategy for Data Analysis.__ Journal of Statistical Software, 40(1), 1-29. URL <http://www.jstatsoft.org/v40/i01/.>

<a id = "kableExtra"> </a>
Hao Zhu (2017). __kableExtra: Construct Complex Table with 'kable' and Pipe Syntax.__ R package version 0.5.2. <https://CRAN.R-project.org/package=kableExtra>

<a id = "INMET, 2011"> </a>
INMET. __Rede de Estações Meteorológicas Automáticas do INMET.__ NOTA TÉCNICA No. 001/2011/SEGER/LAIME/CSC/INMET, p. 4, 2011. <http://www.inmet.gov.br/portal/css/content/topo_iframe/pdf/Nota_Tecnica-Rede_estacoes_INMET.pdf>

<!-- <a id = "(identificador)"> </a> -->
<!-- KANNENBERG, C. __DESAGREGAÇÃO DA TEMPERATURA DO AR DA ESCALA DIÁRIA PARA HORÁRIA PARA O SUL DO BRASIL__, 2016, p. 24. Tese (TCC para obtenção do grau de Bacharel em Meteorologia) – Universidade Federal de Santa Maria, RS, 2016. -->

<a id = "MEEK; HATFIELD, 1994"> </a>
MEEK, D. W.; HATFIELD, J. L. __Data quality checking for single station meteorological databases.__ Agricultural and Forest Meteorology, p. 90-91, 1994. <https://ac.els-cdn.com/0168192394900833/1-s2.0-0168192394900833-main.pdf?_tid=868c718a-0b8d-11e8-8581-00000aab0f26&acdnat=1517956491_41a505ab0f4dff5b801e7e33aab57b66>

<a id = "R"> </a>
R Core Team (2017). __R: A language and environment for statistical computing.__** R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>

<a id = "RStudio"> </a>
RStudio Team (2016). __RStudio: Integrated Development for R__. RStudio, Inc., Boston, MA. <http://www.rstudio.com/>

<a id = "raster"> </a>
Robert J. Hijmans (2016). __raster: Geographic Data Analysis and Modeling.__ R package version 2.5-8. <https://CRAN.R-project.org/package=raster>

<a id = "magrittr"> </a>
Stefan Milton Bache and Hadley Wickham (2014). __magrittr: A Forward-Pipe Operator for R.__ R package version 1.5. <https://CRAN.R-project.org/package=magrittr>

<a id = "VAISALA, 2002"> </a>
VAISALA. __Automatic Weather Station MAWS301 INSTALLATION MANUAL.__ p. 66, 2002. <http://www.eso.org/gen-fac/pubs/astclim/lachira/docs/Vaisala/User%20Guides/M010114en-B.pdf>

<a id = "VEJEN et al., 2002"> </a>
VEJEN et al. __Quality control of meteorological observations: Automatic Methods Used in the Nordic Countries.__ Norwegian Meteorological Institute, p. 11, 2002. <https://pdfs.semanticscholar.org/a0cf/7f5585c0cacee67e72d5583fc1a1d1f4de25.pdf?_ga=2.65464238.1806094589.1521820545-91514076.1517953769>

<a id = "WMO, 1993"> </a>
WMO. __GUIDE ON THE GLOBAL DATA-PROCESSING SYSTEM__, p. VI.21, 1993. <https://library.wmo.int/pmb_ged/wmo_305_en.pdf>

<a id = "WMO, 2012"> </a>
WMO. __Guide to Meteorological Instruments and Methods of Observation__, p. 1, 2012. <https://library.wmo.int/pmb_ged/wmo_8_en-2012.pdf>

<a id = "DT"> </a>
Yihui Xie (2016). __DT: A Wrapper of the JavaScript Library 'DataTables'.__ R package version 0.2. <https://CRAN.R-project.org/package=DT>

<a id = "knitr"> </a>
Yihui Xie (2017). __knitr: A General-Purpose Package for Dynamic Report Generation in R.__ R package version 1.17. <https://cran.r-project.org/web/packages/knitr/index.html>

<a id = "ZAHUMENSKÝ, 2004"> </a>
ZAHUMENSKÝ, I. __Guidelines on Quality Control Procedures for Data from Automatic Weather Stations.__ World Meteorological Organization, p. 3-4, 2004. <https://www.wmo.int/pages/prog/www/IMOP/meetings/Surface/ET-STMT1_Geneva2004/Doc6.1(2).pdf>
